# ğŸ° Casino-Club F2P ì™„ì „ ì¬ì„¤ì • ê°€ì´ë“œ (20250802)

## ğŸš¨ ë¬¸ì œ ìƒí™© ë¶„ì„

í˜„ì¬ í”„ë¡œì íŠ¸ì—ì„œ ë°œìƒí•˜ê³  ìˆëŠ” ì£¼ìš” ë¬¸ì œë“¤:
1. Docker Compose í™˜ê²½ ì„¤ì • ì˜¤ë¥˜
2. ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ì¶©ëŒ
3. ì„œë¹„ìŠ¤ê°„ ì˜ì¡´ì„± ë¬¸ì œ
4. í™˜ê²½ë³€ìˆ˜ ì„¤ì • ë¶ˆì¼ì¹˜
5. í¬íŠ¸ ì¶©ëŒ ë° ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ

## ğŸ“‹ 1ë‹¨ê³„: ì™„ì „ ì´ˆê¸°í™”

### ğŸ§¹ ê¸°ì¡´ í™˜ê²½ ì •ë¦¬
```powershell
# ëª¨ë“  Docker ì»¨í…Œì´ë„ˆ ì •ì§€ ë° ì‚­ì œ
docker-compose down --volumes --remove-orphans

# Docker ì´ë¯¸ì§€ ì •ë¦¬
docker system prune -a --volumes

# ê¸°ì¡´ ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ ì •ë¦¬
Remove-Item -Path "cc-webapp\backend\*.db" -Force -ErrorAction SilentlyContinue
Remove-Item -Path "cc-webapp\backend\logs\*" -Force -Recurse -ErrorAction SilentlyContinue
```

### ğŸ”§ í™˜ê²½ë³€ìˆ˜ íŒŒì¼ ì¬ìƒì„±
`.env.development` íŒŒì¼ì„ ë‹¤ìŒ ë‚´ìš©ìœ¼ë¡œ ì™„ì „íˆ êµì²´:

```env
# === ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • ===
DB_HOST=postgres
DB_PORT=5432
DB_NAME=cc_webapp
DB_USER=cc_user
DB_PASSWORD=cc_secret_password_2025

# PostgreSQL ì»¨í…Œì´ë„ˆ ì„¤ì •
POSTGRES_DB=cc_webapp
POSTGRES_USER=cc_user
POSTGRES_PASSWORD=cc_secret_password_2025

# === Redis ì„¤ì • ===
REDIS_HOST=redis
REDIS_PORT=6379

# === Kafka ì„¤ì • ===
KAFKA_BOOTSTRAP_SERVERS=cc_kafka:9093
KAFKA_HOST_PORT=9093

# === ì„œë¹„ìŠ¤ í¬íŠ¸ ì„¤ì • ===
BACKEND_PORT=8000
FRONTEND_PORT=3000

# === JWT ë³´ì•ˆ ì„¤ì • ===
JWT_SECRET_KEY=casino_club_jwt_secret_key_20250802_very_secure
JWT_ALGORITHM=HS256
JWT_EXPIRE_MINUTES=30

# === ì•± í™˜ê²½ ì„¤ì • ===
APP_ENV=development
DEBUG=true
NODE_ENV=development

# === ì‚¬ì´ë²„ í† í° ì„¤ì • ===
INITIAL_CYBER_TOKENS=200

# === ë³¸ì‚¬ ì—°ë™ ì„¤ì • ===
CORPORATE_SITE_URL=http://localhost:8080
CORPORATE_API_KEY=test_api_key_20250802

# === ì¸ì¦ ì„¤ì • ===
AUTHORIZED_USERS_ONLY=true
```

## ğŸ“‹ 2ë‹¨ê³„: Docker ê´€ë¦¬ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±

### ğŸ›  `docker-manage.ps1` íŒŒì¼ ìƒì„±
```powershell
# Casino-Club F2P Docker ê´€ë¦¬ ìŠ¤í¬ë¦½íŠ¸ v2.0
param(
    [Parameter(Position=0)]
    [string]$Command = "help",
    
    [Parameter(Position=1)]
    [string]$Service = "",
    
    [switch]$Tools,
    [switch]$Force
)

$ErrorActionPreference = "Stop"

# ì»¬ëŸ¬ ì¶œë ¥ í•¨ìˆ˜
function Write-ColoredOutput {
    param([string]$Message, [string]$Color = "White")
    Write-Host $Message -ForegroundColor $Color
}

function Show-Help {
    Write-ColoredOutput "ğŸ° Casino-Club F2P Docker ê´€ë¦¬ ë„êµ¬" "Cyan"
    Write-ColoredOutput "=" * 50 "Gray"
    Write-ColoredOutput "ì‚¬ìš©ë²•: .\docker-manage.ps1 <ëª…ë ¹ì–´> [ì˜µì…˜]" "Yellow"
    Write-ColoredOutput ""
    Write-ColoredOutput "ğŸ“‹ ì£¼ìš” ëª…ë ¹ì–´:" "Green"
    Write-ColoredOutput "  setup        - ì´ˆê¸° í™˜ê²½ ì„¤ì •" "White"
    Write-ColoredOutput "  start        - ì„œë¹„ìŠ¤ ì‹œì‘" "White"
    Write-ColoredOutput "  stop         - ì„œë¹„ìŠ¤ ì •ì§€" "White"
    Write-ColoredOutput "  restart      - ì„œë¹„ìŠ¤ ì¬ì‹œì‘" "White"
    Write-ColoredOutput "  status       - ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸" "White"
    Write-ColoredOutput "  logs         - ë¡œê·¸ í™•ì¸" "White"
    Write-ColoredOutput "  clean        - ì •ë¦¬ ì‘ì—…" "White"
    Write-ColoredOutput "  reset        - ì™„ì „ ì´ˆê¸°í™”" "White"
    Write-ColoredOutput ""
    Write-ColoredOutput "ğŸ”§ ì˜µì…˜:" "Green"
    Write-ColoredOutput "  --tools      - ê°œë°œ ë„êµ¬ í¬í•¨ (pgAdmin, Redis Commander)" "White"
    Write-ColoredOutput "  --force      - ê°•ì œ ì‹¤í–‰" "White"
    Write-ColoredOutput ""
    Write-ColoredOutput "ğŸ“š ì˜ˆì œ:" "Green"
    Write-ColoredOutput "  .\docker-manage.ps1 start --tools" "Gray"
    Write-ColoredOutput "  .\docker-manage.ps1 logs backend" "Gray"
    Write-ColoredOutput "  .\docker-manage.ps1 reset --force" "Gray"
}

function Test-DockerRunning {
    try {
        docker info | Out-Null
        return $true
    } catch {
        Write-ColoredOutput "âŒ Dockerê°€ ì‹¤í–‰ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. Docker Desktopì„ ì‹œì‘í•´ì£¼ì„¸ìš”." "Red"
        exit 1
    }
}

function Setup-Environment {
    Write-ColoredOutput "ğŸš€ Casino-Club F2P í™˜ê²½ ì„¤ì • ì‹œì‘..." "Cyan"
    
    # Docker ìƒíƒœ í™•ì¸
    Test-DockerRunning
    
    # í•„ìˆ˜ ë””ë ‰í† ë¦¬ ìƒì„±
    $directories = @(
        "logs/backend",
        "logs/frontend", 
        "logs/postgres",
        "logs/celery",
        "data/init",
        "data/backup"
    )
    
    foreach ($dir in $directories) {
        if (!(Test-Path $dir)) {
            New-Item -ItemType Directory -Path $dir -Force | Out-Null
            Write-ColoredOutput "ğŸ“ ë””ë ‰í† ë¦¬ ìƒì„±: $dir" "Green"
        }
    }
    
    # í™˜ê²½ë³€ìˆ˜ íŒŒì¼ í™•ì¸
    if (!(Test-Path ".env.development")) {
        Write-ColoredOutput "âš ï¸ .env.development íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤. ìƒ˜í”Œ íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤." "Yellow"
        # í™˜ê²½ë³€ìˆ˜ íŒŒì¼ ìƒì„± ë¡œì§ ì¶”ê°€ í•„ìš”
    }
    
    Write-ColoredOutput "âœ… í™˜ê²½ ì„¤ì • ì™„ë£Œ!" "Green"
}

function Start-Services {
    Write-ColoredOutput "ğŸš€ ì„œë¹„ìŠ¤ ì‹œì‘..." "Cyan"
    
    Test-DockerRunning
    
    $composeArgs = @("up", "-d", "--build")
    
    if ($Tools) {
        $composeArgs += "--profile"
        $composeArgs += "tools"
        Write-ColoredOutput "ğŸ› ï¸ ê°œë°œ ë„êµ¬ í¬í•¨í•˜ì—¬ ì‹œì‘..." "Yellow"
    }
    
    try {
        & docker-compose @composeArgs
        Write-ColoredOutput "âœ… ì„œë¹„ìŠ¤ ì‹œì‘ ì™„ë£Œ!" "Green"
        Show-ServiceStatus
    } catch {
        Write-ColoredOutput "âŒ ì„œë¹„ìŠ¤ ì‹œì‘ ì‹¤íŒ¨: $($_.Exception.Message)" "Red"
        exit 1
    }
}

function Stop-Services {
    Write-ColoredOutput "ğŸ›‘ ì„œë¹„ìŠ¤ ì •ì§€..." "Cyan"
    
    try {
        docker-compose down
        Write-ColoredOutput "âœ… ì„œë¹„ìŠ¤ ì •ì§€ ì™„ë£Œ!" "Green"
    } catch {
        Write-ColoredOutput "âŒ ì„œë¹„ìŠ¤ ì •ì§€ ì‹¤íŒ¨: $($_.Exception.Message)" "Red"
    }
}

function Show-ServiceStatus {
    Write-ColoredOutput "ğŸ“Š ì„œë¹„ìŠ¤ ìƒíƒœ:" "Cyan"
    docker-compose ps
    
    Write-ColoredOutput "`nğŸŒ ì„œë¹„ìŠ¤ URL:" "Cyan"
    Write-ColoredOutput "  Frontend:    http://localhost:3000" "Green"
    Write-ColoredOutput "  Backend API: http://localhost:8000" "Green"
    Write-ColoredOutput "  API Docs:    http://localhost:8000/docs" "Green"
    
    if ($Tools) {
        Write-ColoredOutput "  pgAdmin:     http://localhost:5050" "Yellow"
        Write-ColoredOutput "  Redis UI:    http://localhost:8081" "Yellow"
    }
}

function Show-Logs {
    if ($Service) {
        Write-ColoredOutput "ğŸ“‹ $Service ë¡œê·¸:" "Cyan"
        docker-compose logs -f $Service
    } else {
        Write-ColoredOutput "ğŸ“‹ ì „ì²´ ë¡œê·¸:" "Cyan"
        docker-compose logs -f
    }
}

function Reset-Environment {
    if (!$Force) {
        $confirm = Read-Host "âš ï¸ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/N)"
        if ($confirm -ne "y" -and $confirm -ne "Y") {
            Write-ColoredOutput "âŒ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤." "Yellow"
            return
        }
    }
    
    Write-ColoredOutput "ğŸ§¹ ì™„ì „ ì´ˆê¸°í™” ì‹œì‘..." "Red"
    
    # ì»¨í…Œì´ë„ˆ ì •ì§€ ë° ì‚­ì œ
    docker-compose down --volumes --remove-orphans
    
    # ì´ë¯¸ì§€ ì •ë¦¬
    docker system prune -f
    
    # ë¡œê·¸ íŒŒì¼ ì •ë¦¬
    if (Test-Path "logs") {
        Remove-Item -Path "logs\*" -Recurse -Force -ErrorAction SilentlyContinue
    }
    
    Write-ColoredOutput "âœ… ì™„ì „ ì´ˆê¸°í™” ì™„ë£Œ!" "Green"
    Write-ColoredOutput "ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ ì¬ì‹œì‘í•˜ì„¸ìš”: .\docker-manage.ps1 setup" "Yellow"
}

# ë©”ì¸ ì‹¤í–‰ ë¡œì§
switch ($Command.ToLower()) {
    "help" { Show-Help }
    "setup" { Setup-Environment }
    "start" { Start-Services }
    "stop" { Stop-Services }
    "restart" { Stop-Services; Start-Services }
    "status" { Show-ServiceStatus }
    "logs" { Show-Logs }
    "reset" { Reset-Environment }
    "clean" { Reset-Environment }
    default {
        Write-ColoredOutput "âŒ ì•Œ ìˆ˜ ì—†ëŠ” ëª…ë ¹ì–´: $Command" "Red"
        Show-Help
        exit 1
    }
}
```

## ğŸ“‹ 3ë‹¨ê³„: Docker Compose ì„¤ì • ìˆ˜ì •

### ğŸ³ `docker-compose.yml` ìµœì í™”
í˜„ì¬ docker-compose.yml íŒŒì¼ì˜ ì£¼ìš” ë¬¸ì œì ë“¤ì„ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤:

1. **ë„¤íŠ¸ì›Œí¬ ì„¤ì • ê°œì„ **
2. **í—¬ìŠ¤ì²´í¬ ìµœì í™”** 
3. **ë³¼ë¥¨ ë§ˆìš´íŠ¸ ìˆ˜ì •**
4. **í™˜ê²½ë³€ìˆ˜ ì •ë¦¬**

### ğŸ”§ ìˆ˜ì •ëœ docker-compose.yml ì£¼ìš” ë³€ê²½ì‚¬í•­:
```yaml
# ë²„ì „ ì •ë³´ ì œê±° (obsolete)
# ë„¤íŠ¸ì›Œí¬ ì„¤ì • ê°œì„ 
# í—¬ìŠ¤ì²´í¬ íƒ€ì„ì•„ì›ƒ ì¡°ì •
# ë³¼ë¥¨ ë°”ì¸ë”© ìµœì í™”
```

## ğŸ“‹ 4ë‹¨ê³„: ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ìˆ˜ì •

### ğŸ—„ï¸ Alembic ì„¤ì • ì •ë¦¬
```powershell
# ë°±ì—”ë“œ ì»¨í…Œì´ë„ˆ ì ‘ì†
.\docker-manage.ps1 shell backend

# ë§ˆì´ê·¸ë ˆì´ì…˜ íˆìŠ¤í† ë¦¬ í™•ì¸
alembic history

# í•„ìš”ì‹œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì´ˆê¸°í™”
alembic stamp head
alembic revision --autogenerate -m "Initial migration"
```

## ğŸ“‹ 5ë‹¨ê³„: ë‹¨ê³„ë³„ ì‹¤í–‰ ê°€ì´ë“œ

### ğŸ¯ 1. ì™„ì „ ì´ˆê¸°í™”
```powershell
.\docker-manage.ps1 reset --force
```

### ğŸ¯ 2. í™˜ê²½ ì„¤ì •
```powershell
.\docker-manage.ps1 setup
```

### ğŸ¯ 3. ì„œë¹„ìŠ¤ ì‹œì‘
```powershell
.\docker-manage.ps1 start --tools
```

### ğŸ¯ 4. ìƒíƒœ í™•ì¸
```powershell
.\docker-manage.ps1 status
```

### ğŸ¯ 5. ë¡œê·¸ í™•ì¸
```powershell
.\docker-manage.ps1 logs backend
.\docker-manage.ps1 logs frontend
```

## ğŸ”§ 6ë‹¨ê³„: ë¬¸ì œ í•´ê²° ì²´í¬ë¦¬ìŠ¤íŠ¸

### âœ… í¬íŠ¸ ì¶©ëŒ í•´ê²°
```powershell
# í¬íŠ¸ ì‚¬ìš© í™•ì¸
netstat -ano | findstr :3000
netstat -ano | findstr :8000
netstat -ano | findstr :5432

# í•„ìš”ì‹œ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
taskkill /F /PID <PID>
```

### âœ… Docker ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ í•´ê²°
```powershell
# ë„¤íŠ¸ì›Œí¬ ì •ë¦¬
docker network prune

# ì»¨í…Œì´ë„ˆ IP í™•ì¸
docker network inspect auto7777_ccnet
```

### âœ… ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ë¬¸ì œ í•´ê²°
```powershell
# PostgreSQL ì»¨í…Œì´ë„ˆ ë¡œê·¸ í™•ì¸
.\docker-manage.ps1 logs postgres

# ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸
docker exec -it cc_postgres psql -U cc_user -d cc_webapp
```

## ğŸš€ 7ë‹¨ê³„: ê²€ì¦ ë° í…ŒìŠ¤íŠ¸

### ğŸ“Š ì„œë¹„ìŠ¤ ê²€ì¦
1. **Frontend**: http://localhost:3000
2. **Backend API**: http://localhost:8000/docs
3. **Database**: pgAdmin (http://localhost:5050)

### ğŸ§ª API í…ŒìŠ¤íŠ¸
```powershell
# í—¬ìŠ¤ì²´í¬
curl http://localhost:8000/health

# API ë¬¸ì„œ í™•ì¸
curl http://localhost:8000/docs
```

## ğŸ“ 8ë‹¨ê³„: ëª¨ë‹ˆí„°ë§ ë° ìœ ì§€ë³´ìˆ˜

### ğŸ“ˆ ì¼ì¼ ì ê²€ í•­ëª©
- [ ] ëª¨ë“  ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
- [ ] ë¡œê·¸ íŒŒì¼ í¬ê¸° í™•ì¸
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ìƒíƒœ í™•ì¸
- [ ] API ì‘ë‹µ ì‹œê°„ í™•ì¸

### ğŸ”„ ì •ê¸° ìœ ì§€ë³´ìˆ˜
```powershell
# ì£¼ê°„ ì •ë¦¬ ì‘ì—…
.\docker-manage.ps1 clean

# ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…
.\docker-manage.ps1 backup

# ë¡œê·¸ ì •ë¦¬
Remove-Item "logs\*\*.log" -Force -Recurse
```

## ğŸ†˜ ì‘ê¸‰ ë³µêµ¬ ê°€ì´ë“œ

### ğŸš¨ ì„œë¹„ìŠ¤ ì™„ì „ ì¤‘ë‹¨ ì‹œ
```powershell
# 1. ëª¨ë“  ì„œë¹„ìŠ¤ ì •ì§€
.\docker-manage.ps1 stop

# 2. ì™„ì „ ì´ˆê¸°í™”
.\docker-manage.ps1 reset --force

# 3. ì¬ì‹œì‘
.\docker-manage.ps1 setup
.\docker-manage.ps1 start --tools
```

### ğŸš¨ ë°ì´í„°ë² ì´ìŠ¤ ë³µêµ¬
```powershell
# ë°±ì—…ì—ì„œ ë³µêµ¬
docker exec -i cc_postgres psql -U cc_user -d cc_webapp < backup.sql
```

## ï¿½ 9ë‹¨ê³„: í•µì‹¬ API ì—°ê²° ë¬¸ì œ í•´ê²°

### ğŸš¨ í˜„ì¬ ë¬¸ì œ ìƒí™©
1. **í”„ë¡ íŠ¸ì—”ë“œ ì…ë ¥ â†’ API ì—°ê²° ì‹¤íŒ¨**
2. **API â†’ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨** 
3. **Swagger ë¬¸ì„œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨**
4. **ë°±ì—”ë“œ ë¼ìš°í„° ë“±ë¡ ëˆ„ë½**

### ğŸ¯ ë¬¸ì œ í•´ê²° ë¡œë“œë§µ

#### A. API ë¼ìš°í„° ë“±ë¡ í™•ì¸ ë° ìˆ˜ì •
```powershell
# ë°±ì—”ë“œ ì»¨í…Œì´ë„ˆ ì ‘ì†
docker exec -it cc_backend bash

# main.py íŒŒì¼ì—ì„œ ë¼ìš°í„° ë“±ë¡ í™•ì¸
cat app/main.py | grep "include_router"
```

**ì˜ˆìƒ ë¬¸ì œ**: ë¼ìš°í„°ê°€ ì œëŒ€ë¡œ ë“±ë¡ë˜ì§€ ì•ŠìŒ

**í•´ê²°ë°©ë²•**: `app/main.py` ìˆ˜ì •
```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware

# ë¼ìš°í„° import ì¶”ê°€
from app.routers import (
    auth_router,
    users_router, 
    games_router,
    shop_router,
    battlepass_router
)

app = FastAPI(
    title="Casino-Club F2P API",
    description="ì¹´ì§€ë…¸ í´ëŸ½ F2P ê²Œì„ API",
    version="1.0.0"
)

# CORS ì„¤ì •
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# ë¼ìš°í„° ë“±ë¡ (ìˆœì„œ ì¤‘ìš”!)
app.include_router(auth_router.router, prefix="/api/auth", tags=["ì¸ì¦"])
app.include_router(users_router.router, prefix="/api/users", tags=["ì‚¬ìš©ì"])
app.include_router(games_router.router, prefix="/api/games", tags=["ê²Œì„"])
app.include_router(shop_router.router, prefix="/api/shop", tags=["ìƒì "])
app.include_router(battlepass_router.router, prefix="/api/battlepass", tags=["ë°°í‹€íŒ¨ìŠ¤"])

@app.get("/")
async def root():
    return {"message": "Casino-Club F2P API Server"}

@app.get("/health")
async def health_check():
    return {"status": "healthy", "timestamp": datetime.now()}
```

#### B. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ë¬¸ì œ í•´ê²°

**1. ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ ìƒì„±**
```powershell
# ë°±ì—”ë“œ ë””ë ‰í† ë¦¬ì—ì„œ ì‹¤í–‰
cd cc-webapp/backend
```

**íŒŒì¼ ìƒì„±**: `fix_database_connection.py`
```python
#!/usr/bin/env python3
"""
ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ë¬¸ì œ í•´ê²° ìŠ¤í¬ë¦½íŠ¸
"""
import os
import sys
from sqlalchemy import create_engine, text
from sqlalchemy.exc import OperationalError
import time

def test_db_connection():
    """ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸"""
    
    # í™˜ê²½ë³€ìˆ˜ì—ì„œ DB ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    db_host = os.getenv('DB_HOST', 'postgres')
    db_port = os.getenv('DB_PORT', '5432')
    db_name = os.getenv('DB_NAME', 'cc_webapp')
    db_user = os.getenv('DB_USER', 'cc_user')
    db_password = os.getenv('DB_PASSWORD', 'cc_secret_password_2025')
    
    database_url = f"postgresql://{db_user}:{db_password}@{db_host}:{db_port}/{db_name}"
    
    print(f"ğŸ” ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸...")
    print(f"ğŸ“ ì—°ê²° ì •ë³´: {db_host}:{db_port}/{db_name}")
    
    max_retries = 30
    for attempt in range(max_retries):
        try:
            engine = create_engine(database_url)
            with engine.connect() as conn:
                result = conn.execute(text("SELECT 1"))
                print(f"âœ… ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„±ê³µ!")
                return True
                
        except OperationalError as e:
            print(f"â³ ì—°ê²° ì‹œë„ {attempt + 1}/{max_retries} ì‹¤íŒ¨: {str(e)[:100]}...")
            time.sleep(2)
    
    print(f"âŒ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨!")
    return False

def create_tables():
    """í…Œì´ë¸” ìƒì„±"""
    try:
        from app.database import engine, Base
        from app.models import *  # ëª¨ë“  ëª¨ë¸ import
        
        print("ğŸ—ï¸ í…Œì´ë¸” ìƒì„± ì¤‘...")
        Base.metadata.create_all(bind=engine)
        print("âœ… í…Œì´ë¸” ìƒì„± ì™„ë£Œ!")
        return True
        
    except Exception as e:
        print(f"âŒ í…Œì´ë¸” ìƒì„± ì‹¤íŒ¨: {e}")
        return False

def run_migrations():
    """Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰"""
    try:
        import subprocess
        
        print("ğŸ”„ Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰...")
        
        # ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒíƒœ í™•ì¸
        result = subprocess.run(['alembic', 'current'], 
                              capture_output=True, text=True)
        print(f"í˜„ì¬ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒíƒœ: {result.stdout}")
        
        # ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
        result = subprocess.run(['alembic', 'upgrade', 'head'], 
                              capture_output=True, text=True)
        
        if result.returncode == 0:
            print("âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ!")
            return True
        else:
            print(f"âŒ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨: {result.stderr}")
            return False
            
    except Exception as e:
        print(f"âŒ ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜¤ë¥˜: {e}")
        return False

if __name__ == "__main__":
    print("ğŸš€ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ë¬¸ì œ í•´ê²° ì‹œì‘...")
    
    # 1. ì—°ê²° í…ŒìŠ¤íŠ¸
    if not test_db_connection():
        sys.exit(1)
    
    # 2. í…Œì´ë¸” ìƒì„±
    if not create_tables():
        print("âš ï¸ í…Œì´ë¸” ìƒì„± ì‹¤íŒ¨, ë§ˆì´ê·¸ë ˆì´ì…˜ìœ¼ë¡œ ì¬ì‹œë„...")
    
    # 3. ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
    if not run_migrations():
        sys.exit(1)
    
    print("ğŸ‰ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • ì™„ë£Œ!")
```

#### C. Swagger ë¬¸ì„œ ì—…ë°ì´íŠ¸ ë¬¸ì œ í•´ê²°

**1. FastAPI ì„¤ì • ìˆ˜ì •**
```python
# app/main.pyì—ì„œ OpenAPI ì„¤ì • ì¶”ê°€
app = FastAPI(
    title="Casino-Club F2P API",
    description="""
    ğŸ° Casino-Club F2P ê²Œì„ API
    
    ## ì£¼ìš” ê¸°ëŠ¥
    - ğŸ” JWT ì¸ì¦ ì‹œìŠ¤í…œ
    - ğŸ‘¤ ì‚¬ìš©ì ê´€ë¦¬
    - ğŸ® ê²Œì„ ì‹œìŠ¤í…œ (ìŠ¬ë¡¯, ë£°ë ›, ê°€ìœ„ë°”ìœ„ë³´)
    - ğŸ›’ ìƒì  ì‹œìŠ¤í…œ
    - ğŸ† ë°°í‹€íŒ¨ìŠ¤ ì‹œìŠ¤í…œ
    """,
    version="1.0.0",
    contact={
        "name": "Casino-Club F2P",
        "email": "support@casino-club.local"
    },
    license_info={
        "name": "MIT",
    },
)

# Swagger UI ì»¤ìŠ¤í„°ë§ˆì´ì§•
app.swagger_ui_parameters = {
    "deepLinking": True,
    "displayRequestDuration": True,
    "docExpansion": "none",
    "operationsSorter": "method",
    "filter": True,
    "tagsSorter": "alpha"
}
```

**2. ë¼ìš°í„° íƒœê·¸ ì •ë¦¬**
ê° ë¼ìš°í„° íŒŒì¼ì—ì„œ íƒœê·¸ì™€ ì„¤ëª… ì¶”ê°€:

```python
# app/routers/auth_router.py
from fastapi import APIRouter

router = APIRouter(
    prefix="/auth",
    tags=["ğŸ” ì¸ì¦"],
    responses={404: {"description": "Not found"}},
)

@router.post("/signup", summary="íšŒì›ê°€ì…", description="ì´ˆëŒ€ì½”ë“œì™€ ë‹‰ë„¤ì„ìœ¼ë¡œ íšŒì›ê°€ì…")
async def signup(request: SignupRequest):
    # êµ¬í˜„...
```

#### D. í”„ë¡ íŠ¸ì—”ë“œ API ì—°ê²° ìˆ˜ì •

**1. API í´ë¼ì´ì–¸íŠ¸ ìƒì„±**
```javascript
// cc-webapp/frontend/lib/api-client.js
class ApiClient {
    constructor() {
        this.baseURL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000';
    }

    async request(endpoint, options = {}) {
        const url = `${this.baseURL}${endpoint}`;
        
        const config = {
            headers: {
                'Content-Type': 'application/json',
            },
            ...options,
        };

        // JWT í† í° ì¶”ê°€
        const token = localStorage.getItem('access_token');
        if (token) {
            config.headers.Authorization = `Bearer ${token}`;
        }

        try {
            const response = await fetch(url, config);
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            return await response.json();
        } catch (error) {
            console.error('API request failed:', error);
            throw error;
        }
    }

    // ì¸ì¦ API
    async signup(inviteCode, nickname) {
        return this.request('/api/auth/signup', {
            method: 'POST',
            body: JSON.stringify({ invite_code: inviteCode, nickname }),
        });
    }

    async login(nickname, password) {
        return this.request('/api/auth/login', {
            method: 'POST',
            body: JSON.stringify({ nickname, password }),
        });
    }

    // ê²Œì„ API
    async spinSlot(betAmount) {
        return this.request('/api/games/slot/spin', {
            method: 'POST',
            body: JSON.stringify({ bet_amount: betAmount }),
        });
    }

    // ì‚¬ìš©ì API
    async getUserProfile() {
        return this.request('/api/users/profile');
    }
}

export default new ApiClient();
```

**2. React ì»´í¬ë„ŒíŠ¸ì—ì„œ API ì‚¬ìš©**
```javascript
// cc-webapp/frontend/components/SlotMachine.js
import { useState } from 'react';
import ApiClient from '../lib/api-client';

export default function SlotMachine() {
    const [isSpinning, setIsSpinning] = useState(false);
    const [result, setResult] = useState(null);

    const handleSpin = async () => {
        setIsSpinning(true);
        try {
            const response = await ApiClient.spinSlot(5000);
            setResult(response);
        } catch (error) {
            console.error('Slot spin failed:', error);
            alert('ê²Œì„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        } finally {
            setIsSpinning(false);
        }
    };

    return (
        <div className="slot-machine">
            <button 
                onClick={handleSpin} 
                disabled={isSpinning}
                className="spin-button"
            >
                {isSpinning ? 'ìŠ¤í•€ ì¤‘...' : 'ìŠ¤í•€'}
            </button>
            
            {result && (
                <div className="result">
                    <p>ê²°ê³¼: {result.win ? 'ìŠ¹ë¦¬!' : 'íŒ¨ë°°'}</p>
                    <p>íšë“: {result.prize_amount}ì½”ì¸</p>
                </div>
            )}
        </div>
    );
}
```

#### E. í†µí•© í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±

**íŒŒì¼ ìƒì„±**: `test_api_integration.py`
```python
#!/usr/bin/env python3
"""
API í†µí•© í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
í”„ë¡ íŠ¸ì—”ë“œ â†’ API â†’ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸
"""
import requests
import json
import time

class APIIntegrationTest:
    def __init__(self):
        self.base_url = "http://localhost:8000"
        self.token = None
    
    def test_health_check(self):
        """í—¬ìŠ¤ì²´í¬ í…ŒìŠ¤íŠ¸"""
        try:
            response = requests.get(f"{self.base_url}/health")
            assert response.status_code == 200
            print("âœ… í—¬ìŠ¤ì²´í¬ í†µê³¼")
            return True
        except Exception as e:
            print(f"âŒ í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨: {e}")
            return False
    
    def test_swagger_docs(self):
        """Swagger ë¬¸ì„œ ì ‘ê·¼ í…ŒìŠ¤íŠ¸"""
        try:
            response = requests.get(f"{self.base_url}/docs")
            assert response.status_code == 200
            print("âœ… Swagger ë¬¸ì„œ ì ‘ê·¼ ì„±ê³µ")
            return True
        except Exception as e:
            print(f"âŒ Swagger ë¬¸ì„œ ì ‘ê·¼ ì‹¤íŒ¨: {e}")
            return False
    
    def test_user_signup(self):
        """íšŒì›ê°€ì… í…ŒìŠ¤íŠ¸"""
        try:
            data = {
                "invite_code": "TEST001",
                "nickname": f"testuser_{int(time.time())}"
            }
            response = requests.post(
                f"{self.base_url}/api/auth/signup",
                json=data
            )
            assert response.status_code == 200
            print("âœ… íšŒì›ê°€ì… ì„±ê³µ")
            return response.json()
        except Exception as e:
            print(f"âŒ íšŒì›ê°€ì… ì‹¤íŒ¨: {e}")
            return None
    
    def test_user_login(self, nickname):
        """ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸"""
        try:
            data = {
                "nickname": nickname,
                "password": "default_password"
            }
            response = requests.post(
                f"{self.base_url}/api/auth/login",
                json=data
            )
            assert response.status_code == 200
            self.token = response.json().get("access_token")
            print("âœ… ë¡œê·¸ì¸ ì„±ê³µ")
            return True
        except Exception as e:
            print(f"âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨: {e}")
            return False
    
    def test_authenticated_request(self):
        """ì¸ì¦ì´ í•„ìš”í•œ ìš”ì²­ í…ŒìŠ¤íŠ¸"""
        if not self.token:
            print("âŒ í† í°ì´ ì—†ìŠµë‹ˆë‹¤")
            return False
        
        try:
            headers = {"Authorization": f"Bearer {self.token}"}
            response = requests.get(
                f"{self.base_url}/api/users/profile",
                headers=headers
            )
            assert response.status_code == 200
            print("âœ… ì¸ì¦ëœ ìš”ì²­ ì„±ê³µ")
            return True
        except Exception as e:
            print(f"âŒ ì¸ì¦ëœ ìš”ì²­ ì‹¤íŒ¨: {e}")
            return False
    
    def run_all_tests(self):
        """ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰"""
        print("ğŸš€ API í†µí•© í…ŒìŠ¤íŠ¸ ì‹œì‘...")
        
        # 1. ê¸°ë³¸ ì—°ê²° í…ŒìŠ¤íŠ¸
        if not self.test_health_check():
            return False
        
        if not self.test_swagger_docs():
            return False
        
        # 2. ì¸ì¦ í”Œë¡œìš° í…ŒìŠ¤íŠ¸
        user_data = self.test_user_signup()
        if not user_data:
            return False
        
        if not self.test_user_login(user_data.get("nickname")):
            return False
        
        # 3. ì¸ì¦ëœ ìš”ì²­ í…ŒìŠ¤íŠ¸
        if not self.test_authenticated_request():
            return False
        
        print("ğŸ‰ ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼!")
        return True

if __name__ == "__main__":
    tester = APIIntegrationTest()
    success = tester.run_all_tests()
    exit(0 if success else 1)
```

### ğŸ¯ ì‹¤í–‰ ìˆœì„œ

1. **ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ë¬¸ì œ í•´ê²°**
```powershell
cd cc-webapp/backend
python fix_database_connection.py
```

2. **API í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰**
```powershell
python test_api_integration.py
```

3. **Swagger ë¬¸ì„œ í™•ì¸**
- ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:8000/docs ì ‘ì†
- ëª¨ë“  API ì—”ë“œí¬ì¸íŠ¸ê°€ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸

4. **í”„ë¡ íŠ¸ì—”ë“œ ì—°ê²° í…ŒìŠ¤íŠ¸**
- http://localhost:3000 ì ‘ì†
- íšŒì›ê°€ì…/ë¡œê·¸ì¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
- ê²Œì„ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

ì´ ë°©ë²•ìœ¼ë¡œ **í”„ë¡ íŠ¸ì—”ë“œ â†” API â†” ë°ì´í„°ë² ì´ìŠ¤ â†” ë°±ì—”ë“œ**ì˜ ì™„ì „í•œ ì—°ê²°ì„ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ï¿½ğŸ“š ì¶”ê°€ ì°¸ê³ ìë£Œ

- **í”„ë¡œì íŠ¸ ì•„í‚¤í…ì²˜**: [20250729-ê°€ì´ë“œ006.md](./20250729-ê°€ì´ë“œ006.md)
- **ë°ì´í„°ë² ì´ìŠ¤ ê°€ì´ë“œ**: [DATABASE_MIGRATION_GUIDE.md](./DATABASE_MIGRATION_GUIDE.md)
- **API ë¬¸ì„œ**: http://localhost:8000/docs

---

**âš ï¸ ì¤‘ìš” ì‚¬í•­**
- ì´ ê°€ì´ë“œëŠ” ê°œë°œí™˜ê²½ ê¸°ì¤€ì…ë‹ˆë‹¤
- í”„ë¡œë•ì…˜ ë°°í¬ ì‹œ ë³´ì•ˆ ì„¤ì •ì„ ë°˜ë“œì‹œ ë³€ê²½í•˜ì„¸ìš”
- ì •ê¸°ì ìœ¼ë¡œ ë°±ì—…ì„ ìˆ˜í–‰í•˜ì„¸ìš”
